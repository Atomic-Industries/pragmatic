SHELL = /bin/bash

MAKE = make -s

prefix = @prefix@
includedir = $(prefix)/include
libdir = $(prefix)/lib
docdir = $(prefix)/share/doc/pragmatic

.PHONY: lib test bin docs

default: lib

lib:
	@echo "  BUILD library"
	@(cd src && $(MAKE))

doc:
	@echo "  DOXYGEN (source code documentation)"
	@doxygen Doxyfile > doxygen.log
	@echo "  MAKE manual"
	@(cd docs && $(MAKE))

test: basic_test

basic_test:
	@echo "  TEST"
	@(cd tests && $(MAKE) test)

clean:
	@echo "  CLEAN docs"
	@(cd docs && $(MAKE) clean)
	@echo "  CLEAN src"
	@(cd src && $(MAKE) clean)
	@echo "  CLEAN include"
	@(cd include && rm -rf *.mod)
	@echo "  CLEAN tests"
	@(cd tests && $(MAKE) clean)

distclean: clean
	@echo "   DISTCLEAN"
	@rm -rf config.status config.log Makefile src/Makefile tests/Makefile docs/Makefile

install:
	@(cd src/ && $(MAKE) install)
	@mkdir -p $(DESTDIR)$(includedir)
	@cp -r include/* $(DESTDIR)$(includedir)/
	@mkdir -p $(DESTDIR)$(docdir)
	@cp docs/pragmatic.pdf $(DESTDIR)$(docdir)/
	@cp -r docs/html $(DESTDIR)$(docdir)/
