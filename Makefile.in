SHELL = /bin/bash

MAKE = make -s

PREFIX = @prefix@
includedir = $(PREFIX)/include
libdir = $(PREFIX)/lib
docdir = $(PREFIX)/share/doc/pragmatic

LIB = lib/libpragmatic.a

.PHONY: lib test bin docs

default: lib

lib:
	@echo "  BUILD library"
	@(cd src && $(MAKE))

doc:
	@echo "  DOXYGEN (source code documentation)"
	@doxygen Doxyfile > doxygen.log
	@echo "  MAKE manual"
	@(cd docs && $(MAKE))

test: basic_test

basic_test:
	@echo "  TEST"
	@(cd tests && $(MAKE) test)

clean:
	@echo "  CLEAN lib"
	@rm -rf lib/lib*
	@echo "  CLEAN docs"
	@(cd docs && $(MAKE) clean)
	@echo "  CLEAN src"
	@(cd src && $(MAKE) clean)
	@echo "  CLEAN include"
	@(cd include && rm -rf *.mod)
	@echo "  CLEAN tests"
	@(cd tests && $(MAKE) clean)

distclean: clean
	@echo "   DISTCLEAN"
	@rm -rf config.status config.log Makefile src/Makefile tests/Makefile docs/Makefile

install:
	mkdir -p $(DESTDIR)$(includedir)
	cp -r include/* $(DESTDIR)$(includedir)/
	mkdir -p $(DESTDIR)$(libdir)
	cp -r $(LIB) $(DESTDIR)$(libdir)/
	mkdir -p $(DESTDIR)$(docdir)
	cp docs/pragmatic.pdf $(DESTDIR)$(docdir)/
	cp -r docs/html $(DESTDIR)$(docdir)/
