SHELL = /bin/bash

CXX = @CXX@
CC = @CC@
FC = @FC@

CPPFLAGS = @CPPFLAGS@ @CPPFLAGS_ZOLTAN@ -I../include

CXXFLAGS = $(CPPFLAGS) @CXXFLAGS@ @OPENMP_CXXFLAGS@
CFLAGS = $(CPPFLAGS) @CFLAGS@ @OPENMP_CFLAGS@
FCFLAGS = $(CPPFLAGS) @FCFLAGS@ @OPENMP_FCFLAGS@

AR = @AR@
ARFLAGS = @ARFLAGS@

LIB = ../lib/libpragmatic.a

VPATH = ./:./src

ifeq (@USING_FORTRAN@,yes)
fortran_objs = pragmatic.o  pragmatic_Fortran.o
endif
objects = zoltan_tools.o $(fortran_objs)

.SUFFIXES: .F90 .cpp .c .o

# cancel implicit rule that tries to make .o from .mod with m2c:
%.o: %.mod

.cpp.o:
	@$(CXX) $(CXXFLAGS) -c $<
.c.o:
	@$(CC) $(CFLAGS) -c $<
.F90.o:
	@$(FC) $(FCFLAGS) -c $<

default: lib

lib: $(objects)
	mkdir -p ../lib
	$(AR) $(ARFLAGS) $(LIB) $(objects)
ifeq (@USING_FORTRAN@,yes)
	cp *.mod ../include/
endif

clean:
	rm -rf *.o *.mod
