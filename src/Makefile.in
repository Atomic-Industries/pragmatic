SHELL = /bin/bash

CXX = @CXX@
CC = @CC@
FC = @FC@

CPPFLAGS = @CPPFLAGS@ -I../include

CXXFLAGS = $(CPPFLAGS) @CXXFLAGS@ @OPENMP_CXXFLAGS@
CFLAGS = $(CPPFLAGS) @CFLAGS@ @OPENMP_CFLAGS@
FCFLAGS = $(CPPFLAGS) @FCFLAGS@ @OPENMP_FCFLAGS@

LDFLAGS = @LDFLAGS@ @OPENMP_CXXFLAGS@ -L../lib

libdir = @prefix@/lib
libversion = 2:0:0

VPATH = ./:./src

ifeq (@USING_FORTRAN@,yes)
fortran_objs = pragmatic.lo  
endif
objects = cpragmatic.lo $(fortran_objs)

LIBS = $(objects) @LIBS@

.SUFFIXES: .F90 .cpp .c .o .lo

# cancel implicit rule that tries to make .o from .mod with m2c:
%.o: %.mod

.cpp.lo:
	@libtool --mode=compile --tag=CXX $(CXX) $(CXXFLAGS) -c $<
.c.lo:
	@libtool --mode=compile --tag=CC $(CC) $(CFLAGS) -c $<
.F90.lo:
	@libtool --mode=compile --tag=FC $(FC) $(FCFLAGS) -c $<

default: lib

lib: $(objects)
	mkdir -p ../lib
	libtool --mode=link --tag=CXX  $(CXX) $(LDFLAGS) -o libpragmatic.la $(LIBS) -rpath $(libdir) -version-info $(libversion)
ifeq (@USING_FORTRAN@,yes)
	cp *.mod ../include/
endif

install:
	libtool --mode=install ../install-sh libpragmatic.la $(DESTDIR)$(libdir)/libpragmatic.la

clean:
	rm -rf *.o *.mod *.lo *.la .libs
